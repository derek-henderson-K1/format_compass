define("format_compass/local/courseindex/courseindex",["exports","core_courseformat/local/courseindex/courseindex","core_courseformat/courseeditor"],(function(_exports,_courseindex,_courseeditor){var obj;
/**
   * Course index main component.
   *
   * @module     format_compass/local/courseindex/courseindex
   * @class      format_compass/local/courseindex/courseindex
   * @copyright  2023 KnowledgeOne
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_courseindex=(obj=_courseindex)&&obj.__esModule?obj:{default:obj};class CourseIndexComponent extends _courseindex.default{create(){this.name="courseindex",this.selectors={SECTION:"[data-for='section']",SECTION_CMLIST:"[data-for='cmlist']",CM:"[data-for='cm']",TOGGLER:'[data-action="togglecourseindexsection"]',COLLAPSE:'[data-toggle="collapse"]',DRAWER:".drawer",HOME_CONTAINER:"#courseindex-home-container",LESSONS_CONTAINER:"#courseindex-lessons-container",ASSESSMENTS_CONTAINER:"#courseindex-assessments-container"},this.classes={SECTIONHIDDEN:"dimmed",CMHIDDEN:"dimmed",SECTIONCURRENT:"current",COLLAPSED:"collapsed",SHOW:"show"},this.sections={},this.cms={}}static init(target,selectors){return new CourseIndexComponent({element:document.getElementById(target),reactive:(0,_courseeditor.getCurrentCourseEditor)(),selectors:selectors})}getWatchers(){return[{watch:"section.indexcollapsed:updated",handler:this._refreshSectionCollapsed},{watch:"cm:created",handler:this._createCm},{watch:"cm:deleted",handler:this._deleteCm},{watch:"section:created",handler:this._createSection},{watch:"section:deleted",handler:this._deleteSection},{watch:"course.pageItem:created",handler:this._refreshPageItem},{watch:"course.pageItem:updated",handler:this._refreshPageItem},{watch:"course.sectionlist:updated",handler:this._refreshCourseSectionlist},{watch:"course_format_options:updated",handler:this._refreshCourseSectionlist},{watch:"section.cmlist:updated",handler:this._refreshSectionCmlist}]}_refreshSectionCmlist(_ref){var _element$cmlist;let{element:element}=_ref;const cmlist=null!==(_element$cmlist=element.cmlist)&&void 0!==_element$cmlist?_element$cmlist:[],listparent=this.getElement(this.selectors.SECTION_CMLIST,element.id);this._fixCmOrder(listparent,cmlist,this.cms)}_fixCmOrder(container,neworder,allitems){if(!neworder.length)return container.classList.add("hidden"),void(container.innerHTML="");for(container.classList.remove("hidden"),neworder.forEach(((itemid,index)=>{const item=allitems[itemid],currentitem=container.children[index];void 0!==currentitem?currentitem!==item&&container.insertBefore(item,currentitem):container.append(item)}));container.children.length>neworder.length;)container.removeChild(container.lastChild)}_refreshCourseSectionlist(_ref2){var _state$course$section;let{state:state}=_ref2;const sectionlist=null!==(_state$course$section=state.course.sectionlist)&&void 0!==_state$course$section?_state$course$section:[],course_format_options=state.course_format_options;this._fixSectionsOrder(sectionlist,this.sections,course_format_options)}_fixSectionsOrder(neworder,allitems,course_format_options){let cutoff=parseInt(course_format_options.assessmentscutoff);neworder.forEach(((itemid,index)=>{const item=allitems[itemid];let currentitem;if(0===index)currentitem=this.getElement(this.selectors.HOME_CONTAINER).children[index],this.getElement(this.selectors.HOME_CONTAINER).insertBefore(item,currentitem);else if(course_format_options.hasassessments){if(index>0&&index<cutoff){if(currentitem=this.getElement(this.selectors.LESSONS_CONTAINER).children[index-1],void 0===currentitem)return void this.getElement(this.selectors.LESSONS_CONTAINER).append(item);currentitem!==item&&this.getElement(this.selectors.LESSONS_CONTAINER).insertBefore(item,currentitem)}if(index>=cutoff){if(currentitem=this.getElement(this.selectors.ASSESSMENTS_CONTAINER).children[index-cutoff],void 0===currentitem)return void this.getElement(this.selectors.ASSESSMENTS_CONTAINER).append(item);currentitem!==item&&this.getElement(this.selectors.ASSESSMENTS_CONTAINER).insertBefore(item,currentitem)}}else{if(currentitem=this.getElement(this.selectors.LESSONS_CONTAINER).children[index-1],void 0===currentitem)return void this.getElement(this.selectors.LESSONS_CONTAINER).append(item);currentitem!==item&&this.getElement(this.selectors.LESSONS_CONTAINER).insertBefore(item,currentitem)}}))}}return _exports.default=CourseIndexComponent,_exports.default}));

//# sourceMappingURL=courseindex.min.js.map