define("format_compass/local/courseindex/placeholder",["exports","core/reactive","core/templates","core_courseformat/courseeditor","core/pending","core/str"],(function(_exports,_reactive,_templates,_courseeditor,_pending,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Course index placeholder replacer.
   *
   * @module     format_compass/local/courseindex/placeholder
   * @class      core_courseformat/local/courseindex/placeholder
   * @copyright 2023 Knowledgeone inc. <https://knowledgeone.ca>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_templates=_interopRequireDefault(_templates),_pending=_interopRequireDefault(_pending);class Component extends _reactive.BaseComponent{static init(target,selectors){return new Component({element:document.getElementById(target),reactive:(0,_courseeditor.getCurrentCourseEditor)(),selectors:selectors})}create(){this.pendingContent=new _pending.default("core_courseformat/placeholder:loadcourseindex")}async stateReady(state){this.loadStaticContent()||await this.loadTemplateContent(state)}loadStaticContent(){const index=this.reactive.getStorageValue("courseIndex");return!(!index.html||!index.js)&&(_templates.default.replaceNode(this.element,index.html,index.js),this.pendingContent.resolve(),!0)}async loadTemplateContent(state){const data=this.reactive.getExporter().course(state),course_format_options=state.course_format_options,labels=[{key:"firsttabname",component:"format_compass"},{key:course_format_options.labelforlessonscutoff,component:"format_compass"},{key:course_format_options.labelforassessmentscutoff,component:"format_compass"}];(0,_str.get_strings)(labels,"format_compass").then((function(results){data.homeLabel=results[0],data.lessonsLabel=results[1],data.assessmentsLabel=results[2]})),data.hasassessments=course_format_options.hasassessments,data.cutoff=course_format_options.assessmentscutoff,"0"==data.cutoff&&(data.cutoff=data.sections.length),data.coursehome=new Object,data.assessments=new Array;for(var i=data.sections.length-1;i>-1;i--)data.sections[i].number>=data.cutoff?(data.sections[i].type="assessment",course_format_options.hasassessments&&(data.assessments.push(data.sections[i]),data.sections.splice(i,1))):data.sections[i].type="lesson";data.assessments.reverse(),data.coursehome=data.sections[0],data.sections.splice(0,1);try{const{html:html,js:js}=await _templates.default.renderForPromise("format_compass/local/courseindex/courseindex",data);_templates.default.replaceNode(this.element,html,js),this.pendingContent.resolve(),this.reactive.setStorageValue("courseIndex",{html:html,js:js})}catch(error){throw this.pendingContent.resolve(error),error}}}return _exports.default=Component,_exports.default}));

//# sourceMappingURL=placeholder.min.js.map