{"version":3,"file":"dndsection.min.js","sources":["../../../src/local/courseeditor/dndsection.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Course index section component.\n *\n * This component is used to control specific course section interactions like drag and drop\n * in both course index and course content.\n *\n * @module     format_compass/local/courseeditor/dndsection\n * @class      format_compass/local/courseeditor/dndsection\n * @copyright  2023 KnowledgeOne\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport DndSection from 'core_courseformat/local/courseeditor/dndsection';\n\nexport default class extends DndSection {\n\n    /**\n     * Save some values form the state.\n     *\n     * @param {Object} state the current state\n     */\n    configState(state) {\n        this.id = this.element.dataset.id;\n        this.section = state.section.get(this.id);\n        this.course = state.course;\n        this.course_format_options = state.course_format_options;\n    }\n\n    /**\n     * Display the component dropzone.\n     *\n     * @param {Object} dropdata the accepted drop data\n     */\n    showDropZone(dropdata) {\n        //Show dropzones fort assessments header\n        if(this.sectionitem.id == \"assessmentscutoff\") {\n            if (dropdata.type == 'section') {\n                if (parseInt(this.course_format_options.assessmentscutoff) > dropdata.number) {\n                    this.sectionitem.element.classList.remove(this.classes.DROPUP);\n                    this.sectionitem.element.classList.add(this.classes.DROPDOWN);\n                } else {\n                    this.sectionitem.element.classList.add(this.classes.DROPUP);\n                    this.sectionitem.element.classList.remove(this.classes.DROPDOWN);\n                }\n            }\n        } else {\n            if (dropdata.type == 'cm') {\n                this.getLastCm()?.classList.add(this.classes.DROPDOWN);\n            }\n            if (dropdata.type == 'section') {\n                // The relative move of section depends on the section number.\n                if (this.section.number > dropdata.number) {\n                    this.element.classList.remove(this.classes.DROPUP);\n                    this.element.classList.add(this.classes.DROPDOWN);\n                } else {\n\n                    this.element.classList.add(this.classes.DROPUP);\n                    this.element.classList.remove(this.classes.DROPDOWN);\n                }\n            }\n        }\n    }\n\n    /**\n     * Hide the component dropzone.\n     */\n    hideDropZone() {\n        this.getLastCm()?.classList.remove(this.classes.DROPDOWN);\n        this.element.classList.remove(this.classes.DROPUP);\n        this.element.classList.remove(this.classes.DROPDOWN);\n        // Hide assessments header dropzone\n        this.sectionitem.element.classList.remove(this.classes.DROPUP);\n        this.sectionitem.element.classList.remove(this.classes.DROPDOWN);\n    }\n\n    /**\n     * Drop event handler.\n     *\n     * @param {Object} dropdata the accepted drop data\n     */\n    drop(dropdata) {\n        let cutoffs;\n        let cutoff = parseInt(this.course_format_options.assessmentscutoff);\n\n        // Drops into assessments header\n        if(this.sectionitem.id == \"assessmentscutoff\") {\n            if(dropdata.type == 'section') {\n                if(dropdata.number == cutoff) {\n                    //Drop from assessments to lessons without changing position\n                    this.reactive.dispatch('saveCutoffs', cutoff+1);\n                } else if(dropdata.number == cutoff-1) {\n                    //Drop from lessons to assessments without changing position\n                    this.reactive.dispatch('saveCutoffs', cutoff-1);\n                } else if (dropdata.number < cutoff) {\n                    //Drop from lessons to assessments\n                    let sectionid = this.course.sectionlist[cutoff-1];\n                    cutoffs = [{cutoff: [{ assessment: (cutoff-1) }]}];\n                    this.reactive.dispatch('sectionMove', [dropdata.id], sectionid, cutoffs);\n                } else if (dropdata.number >= cutoff) {\n                    //Drop from assessments to lessons\n                    let sectionid = this.course.sectionlist[cutoff];\n                    cutoffs = [{cutoff: [{ assessment: (cutoff+1) }]}];\n                    this.reactive.dispatch('sectionMove', [dropdata.id], sectionid, cutoffs);\n                }\n            }\n        } else {\n            if (dropdata.type == 'cm') {\n                this.reactive.dispatch('cmMove', [dropdata.id], this.id);\n            }\n            if (dropdata.type == 'section') {\n                //Assessments tab on\n                if(this.course_format_options.hasassessments) {\n                    // Moving within lessons\n                    if(dropdata.number < cutoff && this.section.number < cutoff) {\n                        this.reactive.dispatch('sectionMove', [dropdata.id], this.id);\n                    }\n\n                    //Moving to assessments\n                    if(dropdata.number < cutoff && this.section.number >= cutoff) {\n                        cutoffs = [{cutoff: [{ assessment: (cutoff-1) }]}];\n                        this.reactive.dispatch('sectionMove', [dropdata.id], this.id, cutoffs);\n                    }\n\n                    // Moving within assessments\n                    if(dropdata.number >= cutoff && this.section.number >= cutoff) {\n                        this.reactive.dispatch('sectionMove', [dropdata.id], this.id);\n                    }\n\n                    //Moving to lessons\n                    if(dropdata.number >= cutoff && this.section.number < cutoff) {\n                        cutoffs = [{cutoff: [{ assessment: (cutoff+1) }]}];\n                        this.reactive.dispatch('sectionMove', [dropdata.id], this.id, cutoffs);\n                    }\n                } else {\n                    //assessments tab off\n                    this.reactive.dispatch('sectionMove', [dropdata.id], this.id);\n                }\n            }\n        }\n    }\n}\n"],"names":["DndSection","configState","state","id","this","element","dataset","section","get","course","course_format_options","showDropZone","dropdata","sectionitem","type","parseInt","assessmentscutoff","number","classList","remove","classes","DROPUP","add","DROPDOWN","getLastCm","hideDropZone","drop","cutoffs","cutoff","reactive","dispatch","sectionid","sectionlist","assessment","hasassessments"],"mappings":"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"}