define("format_compass/local/content/actions",["exports","core/reactive","core/modal_factory","core/modal_events","core_form/modalform","core/templates","core/prefetch","core/str","core/normalise","core_course/events","core/pending","core_courseformat/local/courseeditor/contenttree","jquery","core/ajax","core_course/actions","format_compass/local/vendors/chart","format_compass/local/assessments_wheels"],(function(_exports,_reactive,_modal_factory,_modal_events,_modalform,_templates,_prefetch,_str,_normalise,CourseEvents,_pending,_contenttree,_jquery,_ajax,_actions,_chart,_assessments_wheels){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Course state actions dispatcher.
   *
   * This module captures all data-dispatch links in the course content and dispatch the proper
   * state mutation, including any confirmation and modal required.
   *
   * @module     format_compass/local/content/actions
   * @class      format_compass/local/content/actions
   * @copyright  2023 Knowledgeone inc. <https://knowledgeone.ca>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_modalform=_interopRequireDefault(_modalform),_templates=_interopRequireDefault(_templates),CourseEvents=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(CourseEvents),_pending=_interopRequireDefault(_pending),_contenttree=_interopRequireDefault(_contenttree),_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_actions=_interopRequireDefault(_actions),_chart=_interopRequireDefault(_chart),(0,_prefetch.prefetchStrings)("core",["movecoursesection","movecoursemodule","confirm","delete"]);const directMutations={sectionHide:"sectionHide",sectionShow:"sectionShow",cmHide:"cmHide",cmShow:"cmShow",cmStealth:"cmStealth",cmMoveRight:"cmMoveRight",cmMoveLeft:"cmMoveLeft"};class _default extends _reactive.BaseComponent{create(){this.name="content_actions",this.selectors={ACTIONLINK:"[data-action]",SECTIONLINK:"[data-for='section']",CMLINK:"[data-for='cm']",SECTIONNODE:"[data-for='sectionnode']",MODALTOGGLER:"[data-toggle='collapse']",ADDSECTION:"[data-action='addSection']",CONTENTTREE:"#destination-selector",ACTIONMENU:".action-menu",ACTIONMENUTOGGLER:'[data-toggle="dropdown"]'},this.classes={DISABLED:"text-body",ITALIC:"font-italic"}}static addActions(actions){for(const[action,mutationReference]of Object.entries(actions)){if("function"!=typeof mutationReference&&"string"!=typeof mutationReference)throw new Error("".concat(action," action must be a mutation name or a function"));directMutations[action]=mutationReference}}stateReady(state){this.addEventListener(this.element,"click",this._dispatchClick),this._checkSectionlist({state:state}),this.addEventListener(this.element,CourseEvents.sectionRefreshed,(()=>this._checkSectionlist({state:state})))}getWatchers(){return[{watch:"course.sectionlist:updated",handler:this._checkSectionlist},{watch:"section.sectionweight:updated",handler:this._updateSectionWeight}]}async _getAllChartData(_ref){let{state:state}=_ref;var assessmentscutoff=(await this.getCourseFormatOptions(state.course.id)).assessmentscutoff,chartsData=[];state.section.forEach((section=>{if(parseInt(section.number)>=parseInt(assessmentscutoff)&&"weighttype_weighted"==section.sectionweight.type_of_grade_weighting){let chart={chartValue:"",chartColor:"",chartKey:""};var percentagetotal=0;if("weighttype_singlemultiple_single"==section.sectionweight.weighttype_singlemultiple&&(percentagetotal=section.sectionweight.weighttype_singlevalue_weightvalue,chart.chartValue=percentagetotal),"weighttype_singlemultiple_multiplier"==section.sectionweight.weighttype_singlemultiple&&(percentagetotal=section.sectionweight.weighttype_multiplier_weightvalue*section.sectionweight.weighttype_multiplier_multipliervalue,chart.chartValue=percentagetotal),"weighttype_singlemultiple_csv"==section.sectionweight.weighttype_singlemultiple){var csvValues=section.sectionweight.weighttype_multiplier_csvvalue.replace(" ","");(csvValues=csvValues.split(",")).forEach((value=>{percentagetotal+=parseInt(value)})),chart.chartValue=percentagetotal}chart.chartKey=section.id.toString(),chart.chartColor=getComputedStyle(document.body).getPropertyValue("--weight_wheel_bg_colour"),chartsData.push(chart)}}));var newChartFillTotal=0;if(chartsData.forEach((item=>{newChartFillTotal+=parseInt(item.chartValue)})),newChartFillTotal<100){let chart={chartValue:"",chartKey:"fill",chartColor:""};chart.chartValue=100-newChartFillTotal,chart.chartColor=getComputedStyle(document.body).getPropertyValue("--weight_wheel_disabled_colour"),chartsData.push(chart)}return chartsData}async _updateAllCharts(_ref2,chartData){let{state:state}=_ref2;var assessmentscutoff=(await this.getCourseFormatOptions(state.course.id)).assessmentscutoff;state.section.forEach((section=>{parseInt(section.number)>=parseInt(assessmentscutoff)&&"weighttype_weighted"==section.sectionweight.type_of_grade_weighting&&window["chartUpdateData"+section.id](chartData,state.course.sectionlist)}))}async _updateSectionWeight(_ref3){let{state:state,element:element}=_ref3;var bonuspercent;("weighttype_ungraded"==element.sectionweight.type_of_grade_weighting&&(_templates.default.renderForPromise("format_compass/local/assessments/weightwheels/ungraded",{id:element.id,editing:!0}).then((_ref4=>{let{html:html}=_ref4;document.getElementById("assessment"+element.id+"-weight-container").innerHTML=html})),chartData=await this._getAllChartData({state:state,element:element}),this._updateAllCharts({state:state},chartData)),"weighttype_bonus"==element.sectionweight.type_of_grade_weighting)&&(await(0,_str.get_string)("assessments_chart_percent","format_compass",element.sectionweight.weighttype_bonus_value).then((str=>{bonuspercent=str})),_templates.default.renderForPromise("format_compass/local/assessments/weightwheels/bonus",{id:element.id,editing:!0,bonuspercent:bonuspercent}).then((_ref5=>{let{html:html}=_ref5;document.getElementById("assessment"+element.id+"-weight-container").innerHTML=html})),chartData=await this._getAllChartData({state:state,element:element}),this._updateAllCharts({state:state},chartData));if("weighttype_weighted"==element.sectionweight.type_of_grade_weighting){var chartData,chartPercentBreakdown="",chartPercent="";if("weighttype_singlemultiple_single"==element.sectionweight.weighttype_singlemultiple&&await(0,_str.get_string)("assessments_chart_percent","format_compass",element.sectionweight.weighttype_singlevalue_weightvalue).then((str=>{chartPercent=str})),"weighttype_singlemultiple_multiplier"==element.sectionweight.weighttype_singlemultiple){var percentagetotal=element.sectionweight.weighttype_multiplier_weightvalue*element.sectionweight.weighttype_multiplier_multipliervalue;await(0,_str.get_string)("assessments_chart_percent","format_compass",percentagetotal).then((str=>{chartPercent=str})),await(0,_str.get_string)("assessments_chart_multiplier","format_compass",element.sectionweight).then((str=>{chartPercentBreakdown=str}))}if("weighttype_singlemultiple_csv"==element.sectionweight.weighttype_singlemultiple){var totalweight=0;element.sectionweight.weighttype_multiplier_csvvalue.replace(/ /g,"").split(",").forEach((value=>{totalweight+=parseInt(value)})),chartPercent=await(0,_str.get_string)("assessments_chart_percent","format_compass",totalweight),chartPercentBreakdown="("+element.sectionweight.weighttype_multiplier_csvvalue.replace(/,/g,"+").replace(/ /g,"")+")"}chartData=await this._getAllChartData({state:state,element:element}),this._updateAllCharts({state:state},chartData);let chartValues=[],chartKeys=[],chartColors=[];chartData.forEach(((item,i)=>{chartValues.push(item.chartValue),chartKeys.push(item.chartKey),chartColors.push(item.chartColor)})),_templates.default.renderForPromise("format_compass/local/assessments/weightwheels/graded",{id:element.id,editing:!0,chartpercent:chartPercent}).then((_ref6=>{let{html:html}=_ref6;document.getElementById("assessment"+element.id+"-weight-container").innerHTML=html;var canvasId="weightwheel"+element.id;(0,_assessments_wheels.init)(canvasId,chartValues.toString(),chartColors.toString(),chartKeys.toString(),element.id),document.querySelector("#assessment"+element.id+"-weight-container .compass-weightwheel-percent-breakdown-edit").innerHTML=chartPercentBreakdown}))}}_dispatchClick(event){const target=event.target.closest(this.selectors.ACTIONLINK);if(!target)return;if(target.classList.contains(this.classes.DISABLED))return void event.preventDefault();const actionName=target.dataset.action,methodName=this._actionMethodName(actionName);if(void 0===this[methodName])return void 0!==directMutations[actionName]?"function"==typeof directMutations[actionName]?void directMutations[actionName](target,event):void this._requestMutationAction(target,event,directMutations[actionName]):void 0;this[methodName](target,event)}async _requestRenameSection(target,event){event.preventDefault();const courseId=JSON.parse(JSON.stringify(this.reactive.state)).course.id,sectionId=target.getAttribute("data-id"),sectionInfo=this.reactive.get("section",sectionId),tab=new URLSearchParams(window.location.href).get("tab"),modalForm=new _modalform.default({formClass:"format_compass\\form\\renamesection_form",args:{courseid:courseId,id:sectionId,title:sectionInfo.title,num:sectionInfo.number,tab:tab},modalConfig:{title:sectionInfo.title}});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(e=>{this.reactive.dispatch("sectionRenameState",e.detail.data)})),modalForm.addEventListener("change",(e=>{null===e.target||"id_sectionname_type"!=e.target.id&&!e.target.className.includes("custom-select")||this.SetCustomSectionName()})),modalForm.show()}async _requestEditGradeWeight(target,event){event.preventDefault();const courseId=JSON.parse(JSON.stringify(this.reactive.state)).course.id,sectionId=target.getAttribute("data-id"),sectionInfo=this.reactive.get("section",sectionId),tab=new URLSearchParams(window.location.href).get("tab"),modalForm=new _modalform.default({formClass:"format_compass\\form\\editgradeweight_form",args:{courseid:courseId,id:sectionId,name:sectionInfo.title,num:sectionInfo.number,tab:tab},modalConfig:{title:sectionInfo.title}});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(e=>{this.reactive.dispatch("sectionEditGradeWeight",e.detail.data)})),modalForm.addEventListener("change",(e=>{null!==e.target&&"id_weighttype_multiplier_csvvalue"==e.target.id?this.SetCSVPreviewValue():null===e.target||"id_weighttype_multiplier_weightvalue"!=e.target.id&&"id_weighttype_multiplier_multipliervalue"!=e.target.id?null!==e.target&&"id_weighttype_singlemultiple"==e.target.id?this.SetSingleMultiplePreviewValue():null!==e.target&&"id_type_of_grade_weighting"==e.target.id&&this.SetTypeOfGradeWeightingValue():this.SetMultiplierPreviewValue()})),modalForm.show()}SetCSVPreviewValue(){var totalValue=this.CalculateCSVPreviewValue();this.SetPreviewValue(totalValue)}SetMultiplierPreviewValue(){var totalValue=this.CalculateMultiplierPreviewValue();this.SetPreviewValue(totalValue)}SetSingleMultiplePreviewValue(){var weighttype_singlemultiple=document.getElementById("id_weighttype_singlemultiple").value;"weighttype_singlemultiple_csv"==weighttype_singlemultiple?this.SetCSVPreviewValue():"weighttype_singlemultiple_multiplier"==weighttype_singlemultiple&&this.SetMultiplierPreviewValue()}SetTypeOfGradeWeightingValue(){"weighttype_weighted"==document.getElementById("id_type_of_grade_weighting").value&&this.SetSingleMultiplePreviewValue()}SetCustomSectionName(){var sectionName=document.querySelector('[tag="id_sectionname"]'),first_termvalue=document.getElementById("id_sectionname_first_term").selectedOptions[0].text,first_numbervalue=document.getElementById("id_sectionname_first_number").selectedOptions[0].text,second_termvalue=document.getElementById("id_sectionname_second_term").selectedOptions[0].text,second_numbervalue=document.getElementById("id_sectionname_second_number").selectedOptions[0].text,sectionname_typevalue=document.getElementById("id_sectionname_type").value;"sectionname_freetype"!=sectionname_typevalue&&("sectionname_doubleterm_doublenumber"==sectionname_typevalue?sectionName.value=first_termvalue+" "+first_numbervalue+" - "+second_termvalue+" "+second_numbervalue:"sectionname_singleterm_doublenumber"==sectionname_typevalue?sectionName.value=first_termvalue+" "+first_numbervalue+"."+second_numbervalue:"sectionname_singleterm_singlenumber"==sectionname_typevalue&&(sectionName.value=first_termvalue+" "+first_numbervalue))}_actionMethodName(name){const requestName=name.charAt(0).toUpperCase()+name.slice(1);return"_request".concat(requestName)}CalculateCSVPreviewValue(){var weighttype_multiplier_csvarray=document.getElementById("id_weighttype_multiplier_csvvalue").value.split(","),totalValue=0,breakdown="";if(weighttype_multiplier_csvarray.forEach(((value,i)=>{totalValue+=parseFloat(value),i<weighttype_multiplier_csvarray.length-1?breakdown+=value+"+":breakdown+=value})),isNaN(totalValue))totalValue="N/A";else{var result=totalValue-Math.floor(totalValue)!=0;totalValue=result?totalValue.toFixed(2)+"% ("+breakdown.replace(/\s/g,"")+")":totalValue+"% ("+breakdown.replace(/\s/g,"")+")"}return totalValue}CalculateMultiplierPreviewValue(){var weighttype_multiplier_weightvalue=document.getElementById("id_weighttype_multiplier_weightvalue").value,weighttype_multiplier_multipliervalue=document.getElementById("id_weighttype_multiplier_multipliervalue").value;if(weighttype_multiplier_weightvalue&&weighttype_multiplier_multipliervalue){var totalValue=weighttype_multiplier_weightvalue*weighttype_multiplier_multipliervalue;if(isNaN(totalValue))totalValue="N/A";else totalValue-Math.floor(totalValue)!=0&&(totalValue=totalValue.toFixed(2)),totalValue+="% ("+(weighttype_multiplier_multipliervalue+" x "+weighttype_multiplier_weightvalue+"%")+")"}else totalValue="N/A";return totalValue}SetPreviewValue(totalValue){document.querySelector("[data-groupname=staticgroup] [data-fieldtype=group]").innerHTML=totalValue}_checkSectionlist(_ref7){let{state:state}=_ref7;this._setAddSectionLocked(state.course.sectionlist.length>state.course.maxsections)}async getCourseFormatOptions(courseid){const args={};let ajaxresult;return args.courseid=courseid,ajaxresult=await _ajax.default.call([{methodname:"core_courseformat_get_state",args:args}])[0],JSON.parse(ajaxresult).course_format_options}async getCutoffStrings(course_format_options){const labels=[{key:course_format_options.labelforlessonscutoff,component:"format_compass"},{key:course_format_options.labelforassessmentscutoff,component:"format_compass"}];return await(0,_str.get_strings)(labels,"format_compass")}async _requestMoveSection(target,event){const sectionId=target.dataset.id;if(!sectionId)return;const sectionInfo=this.reactive.get("section",sectionId);event.preventDefault();const pendingModalReady=new _pending.default("courseformat/actions:prepareMoveSectionModal"),editTools=this._getClosestActionMenuToogler(target),data=this.reactive.getExporter().course(this.reactive.state),state=JSON.parse(JSON.stringify(this.reactive.state)),course_format_options=await this.getCourseFormatOptions(state.course.id),labels=await this.getCutoffStrings(course_format_options);data.lessonsLabel=labels[0],data.assessmentsLabel=labels[1],data.hasassessments=course_format_options.hasassessments,data.cutoff=course_format_options.assessmentscutoff,data.sectionid=sectionInfo.id,data.sectiontitle=sectionInfo.title,data.coursehome=new Object,data.assessments=new Array,"0"==data.cutoff&&(data.cutoff=data.sections.length);for(var i=data.sections.length-1;i>-1;i--)data.sections[i].number>=data.cutoff?(data.sections[i].type="assessment",course_format_options.hasassessments&&(data.assessments.push(data.sections[i]),data.sections.splice(i,1))):data.sections[i].type="lesson";data.assessments.reverse(),data.coursehome=data.sections[0],data.sections.splice(0,1);const modalParams={title:(0,_str.get_string)("movecoursesection","core"),body:_templates.default.render("format_compass/local/content/movesection",data)},modal=await this._modalBodyRenderedPromise(modalParams),modalBody=(0,_normalise.getList)(modal.getBody())[0],currentElement=modalBody.querySelector("".concat(this.selectors.SECTIONLINK,"[data-id='").concat(sectionId,"']"));this._disableLink(currentElement);const generalSection=modalBody.querySelector("".concat(this.selectors.SECTIONLINK,"[data-number='0']"));this._disableLink(generalSection),new _contenttree.default(modalBody.querySelector(this.selectors.CONTENTTREE),{SECTION:this.selectors.SECTIONNODE,TOGGLER:this.selectors.MODALTOGGLER,COLLAPSE:this.selectors.MODALTOGGLER},!0),modalBody.addEventListener("click",(event=>{const target=event.target;let offset=0;"assessment"!=currentElement.dataset.type&&"assessment"==target.dataset.type?offset--:"assessment"==currentElement.dataset.type&&"assessment"!=target.dataset.type&&offset++;let cutoffs=[{cutoff:[{assessment:parseInt(data.cutoff)+offset}]}];target.matches("a")&&void 0!==target.dataset.id&&(target.getAttribute("aria-disabled")||(event.preventDefault(),"assessments_header"!=target.dataset.id?this.reactive.dispatch("sectionMove",[sectionId],target.dataset.id,cutoffs):parseInt(currentElement.dataset.number)>=data.cutoff?(cutoffs[0].cutoff[0].assessment++,data.sections[0]||parseInt(currentElement.dataset.number)>1?data.assessments[0].id==currentElement.dataset.id?this.reactive.dispatch("saveCutoffs",cutoffs[0].cutoff[0].assessment):this.reactive.dispatch("sectionMove",[sectionId],data.assessments[0].id,cutoffs):this.reactive.dispatch("sectionMove",[sectionId],data.coursehome.id,cutoffs)):1==data.sections.length||data.sections[data.sections.length-1].id==currentElement.dataset.id?this.reactive.dispatch("saveCutoffs",cutoffs[0].cutoff[0].assessment):this.reactive.dispatch("sectionMove",[sectionId],data.sections[data.sections.length-1].id,cutoffs),this._destroyModal(modal,editTools)))})),pendingModalReady.resolve()}async _requestMoveCm(target,event){var _toggler$data;const cmId=target.dataset.id;if(!cmId)return;const cmInfo=this.reactive.get("cm",cmId);event.preventDefault();const pendingModalReady=new _pending.default("courseformat/actions:prepareMoveCmModal"),editTools=this._getClosestActionMenuToogler(target),exporter=this.reactive.getExporter(),data=exporter.course(this.reactive.state),state=JSON.parse(JSON.stringify(this.reactive.state)),course_format_options=await this.getCourseFormatOptions(state.course.id),labels=await this.getCutoffStrings(course_format_options);if(data.lessonsLabel=labels[0],data.assessmentsLabel=labels[1],data.hasassessments=course_format_options.hasassessments,data.cutoff=course_format_options.assessmentscutoff,"0"==data.cutoff&&(data.cutoff=data.sections.length),data.coursehome=new Object,data.assessments=new Array,course_format_options.hasassessments){for(var i=data.sections.length-1;i>-1;i--)data.sections[i].number>=data.cutoff&&(data.sections[i].type="assessment",data.assessments.push(data.sections[i]),data.sections.splice(i,1));data.assessments.reverse()}data.coursehome=data.sections[0],data.sections.splice(0,1),data.cmid=cmInfo.id,data.cmname=cmInfo.name;const modalParams={title:(0,_str.get_string)("movecoursemodule","core"),body:_templates.default.render("format_compass/local/content/movecm",data)},modal=await this._modalBodyRenderedPromise(modalParams),modalBody=(0,_normalise.getList)(modal.getBody())[0];let currentElement=modalBody.querySelector("".concat(this.selectors.CMLINK,"[data-id='").concat(cmId,"']"));this._disableLink(currentElement),new _contenttree.default(modalBody.querySelector(this.selectors.CONTENTTREE),{SECTION:this.selectors.SECTIONNODE,TOGGLER:this.selectors.MODALTOGGLER,COLLAPSE:this.selectors.MODALTOGGLER,ENTER:this.selectors.SECTIONLINK});const sectionnode=currentElement.closest(this.selectors.SECTIONNODE),toggler=(0,_jquery.default)(sectionnode).find(this.selectors.MODALTOGGLER);let collapsibleId=null!==(_toggler$data=toggler.data("target"))&&void 0!==_toggler$data?_toggler$data:toggler.attr("href");collapsibleId&&(collapsibleId=collapsibleId.replace("#",""),(0,_jquery.default)("#".concat(collapsibleId)).collapse("toggle")),modalBody.addEventListener("click",(event=>{const target=event.target;if(!target.matches("a")||void 0===target.dataset.for||void 0===target.dataset.id)return;if(target.getAttribute("aria-disabled"))return;let targetSectionId,targetCmId;if(event.preventDefault(),"cm"==target.dataset.for){const dropData=exporter.cmDraggableData(this.reactive.state,target.dataset.id);targetSectionId=dropData.sectionid,targetCmId=dropData.nextcmid}else{const section=this.reactive.get("section",target.dataset.id);targetSectionId=target.dataset.id,targetCmId=null==section?void 0:section.cmlist[0]}this.reactive.dispatch("cmMove",[cmId],targetSectionId,targetCmId),this._destroyModal(modal,editTools)})),pendingModalReady.resolve()}async _requestAddSection(target,event){var _target$dataset$id;if(!target.dataset.id)return;const tab=new URLSearchParams(window.location.href).get("tab");event.preventDefault();const data=this.reactive.getExporter().course(this.reactive.state),state=JSON.parse(JSON.stringify(this.reactive.state)),course_format_options=await this.getCourseFormatOptions(state.course.id);let cutoffs;data.cutoff=course_format_options.assessmentscutoff,"0"==data.cutoff&&(data.cutoff=data.sections.length),cutoffs=tab.includes("assessments")?[{cutoff:[{assessment:parseInt(data.cutoff)}]}]:[{cutoff:[{assessment:parseInt(data.cutoff)+1}]}],this.reactive.dispatch("addSection",null!==(_target$dataset$id=target.dataset.id)&&void 0!==_target$dataset$id?_target$dataset$id:0,cutoffs)}async _requestDeleteSection(target,event){var _sectionInfo$cmlist;const sectionId=target.dataset.id;if(!sectionId)return;const sectionInfo=this.reactive.get("section",sectionId);event.preventDefault();const state=JSON.parse(JSON.stringify(this.reactive.state)),course_format_options=await this.getCourseFormatOptions(state.course.id);let cutoffs,offset=0;course_format_options.hasassessments&&(parseInt(sectionInfo.number)<parseInt(course_format_options.assessmentscutoff)&&offset--,cutoffs=[{cutoff:[{assessment:parseInt(course_format_options.assessmentscutoff)+offset}]}]);if((null!==(_sectionInfo$cmlist=sectionInfo.cmlist)&&void 0!==_sectionInfo$cmlist?_sectionInfo$cmlist:[]).length||sectionInfo.hassummary||sectionInfo.rawtitle){const modalParams={title:(0,_str.get_string)("confirm","core"),body:(0,_str.get_string)("confirmdeletesection","moodle",sectionInfo.title),saveButtonText:(0,_str.get_string)("delete","core"),type:_modal_factory.default.types.SAVE_CANCEL},modal=await this._modalBodyRenderedPromise(modalParams);modal.getRoot().on(_modal_events.default.save,(e=>{e.preventDefault(),modal.destroy(),this.reactive.dispatch("sectionDelete",[sectionId],cutoffs)}))}else this.reactive.dispatch("sectionDelete",[sectionId],cutoffs)}async _requestMutationAction(target,event,mutationName){target.dataset.id&&(event.preventDefault(),this.reactive.dispatch(mutationName,[target.dataset.id]))}_setAddSectionLocked(locked){this.getElements(this.selectors.ADDSECTION).forEach((element=>{element.classList.toggle(this.classes.DISABLED,locked),element.classList.toggle(this.classes.ITALIC,locked),this.setElementLocked(element,locked)}))}_disableLink(element){element&&(element.style.pointerEvents="none",element.style.userSelect="none",element.classList.add(this.classes.DISABLED),element.classList.add(this.classes.ITALIC),element.setAttribute("aria-disabled",!0),element.addEventListener("click",(event=>event.preventDefault())))}_modalBodyRenderedPromise(modalParams){return new Promise(((resolve,reject)=>{_modal_factory.default.create(modalParams).then((modal=>{modal.setRemoveOnClose(!0),modal.getRoot().on(_modal_events.default.bodyRendered,(()=>{resolve(modal)})),void 0!==modalParams.saveButtonText&&modal.setSaveButtonText(modalParams.saveButtonText),modal.show()})).catch((()=>{reject("Cannot load modal content")}))}))}_destroyModal(modal,element){modal.hide();const pendingDestroy=new _pending.default("courseformat/actions:destroyModal");element&&element.focus(),setTimeout((()=>{modal.destroy(),pendingDestroy.resolve()}),500)}_getClosestActionMenuToogler(element){const actionMenu=element.closest(this.selectors.ACTIONMENU);if(actionMenu)return actionMenu.querySelector(this.selectors.ACTIONMENUTOGGLER)}}return _exports.default=_default,_exports.default}));

//# sourceMappingURL=actions.min.js.map