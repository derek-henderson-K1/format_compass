{"version":3,"file":"editsection_form.min.js","sources":["../../src/local/editsection_form.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A javascript module to enhance the editsection form.\n *\n * @copyright  2023 KnowledgeOne\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\n\n\nexport const editsection_form_helper = () => {\n\n    /**\n     * A common javascript function to set custom section names\n     */\n    function SetCustomSectionName()\n    {\n        var sectionName = $('[tag=\"id_sectionname\"]').get(0);\n        var first_termvalue = $('#id_sectionname_first_term').get(0).selectedOptions[0].text;\n        var first_numbervalue = $('#id_sectionname_first_number').get(0).selectedOptions[0].text;\n        var second_termvalue = $('#id_sectionname_second_term').get(0).selectedOptions[0].text;\n        var second_numbervalue = $('#id_sectionname_second_number').get(0).selectedOptions[0].text;\n\n        var sectionname_typevalue = $('#id_sectionname_type').val();\n        if (sectionname_typevalue != \"sectionname_freetype\") {\n            if (sectionname_typevalue == \"sectionname_doubleterm_doublenumber\") {\n                sectionName.value = first_termvalue + \" \" + first_numbervalue + \" - \" + second_termvalue + \" \" + second_numbervalue;\n            } else if (sectionname_typevalue == \"sectionname_singleterm_doublenumber\") {\n                sectionName.value = first_termvalue + \" \" + first_numbervalue + \".\" + second_numbervalue;\n            } else if (sectionname_typevalue == \"sectionname_singleterm_singlenumber\") {\n                sectionName.value = first_termvalue + \" \" + first_numbervalue;\n            }\n        }\n    }\n\n    $(\"body\").on(\"change\", function(event) {\n        var defaultcustomcheckbox = $('input[type=checkbox][name=\"name[customize]\"]').get(0);\n        if (defaultcustomcheckbox!==null && event.target!==null && event.target.id == defaultcustomcheckbox.id) {\n            if (event.target.checked == true) {\n                SetCustomSectionName();\n            }\n        }\n    });\n\n    $(document).ready(function() {\n        var weighttype_singlemultiple = $('#id_weighttype_singlemultiple').val();\n        if (weighttype_singlemultiple == \"weighttype_singlemultiple_csv\") {\n            var totalValue = CalculateCSVPreviewValue();\n            SetPreviewValue(totalValue);\n        } else if (weighttype_singlemultiple == \"weighttype_singlemultiple_multiplier\") {\n            var totalValue = CalculateMultiplierPreviewValue();\n            SetPreviewValue(totalValue);\n        }\n    });\n\n    $('form').on('submit', function() {\n        $('[tag=\"id_sectionname\"]').removeAttr('disabled');\n        // get all the inputs into an array.\n        var $inputs = $('form :input');\n\n        // loop through the array to set the disabled elements back to their original value\n        $inputs.each(function() {\n            if (this.disabled == true) {\n                if (this.attributes['value']!== undefined && this.attributes['value']!==null) {\n                    this.disabled = false;\n                    this.value = this.attributes['value'].value;\n                    this.disabled = true;\n                }\n            }\n        });\n    });\n\n    $('.select_name_type_option').on('change', function() {\n        SetCustomSectionName();\n    });\n\n    $('#id_weighttype_singlemultiple').on('change', function() {\n        var weighttype_singlemultiple = $('#id_weighttype_singlemultiple').val();\n        if (weighttype_singlemultiple == \"weighttype_singlemultiple_csv\") {\n            var totalValue = CalculateCSVPreviewValue();\n            SetPreviewValue(totalValue);\n        } else if (weighttype_singlemultiple == \"weighttype_singlemultiple_multiplier\") {\n            var totalValue = CalculateMultiplierPreviewValue();\n            SetPreviewValue(totalValue);\n        }\n    });\n\n    $('#id_weighttype_multiplier_csvvalue').on('change', function() {\n        var totalValue = CalculateCSVPreviewValue();\n        SetPreviewValue(totalValue);\n    });\n\n    $('.class_weighttype_multiplier').on('change', function() {\n        var totalValue = CalculateMultiplierPreviewValue();\n        SetPreviewValue(totalValue);\n    });\n\n    /**\n     * Calculate CSVPreviewValue from csv string on change function\n     */\n     function CalculateCSVPreviewValue() {\n        var weighttype_multiplier_csvvalue = $('#id_weighttype_multiplier_csvvalue').get(0).value;\n        var weighttype_multiplier_csvarray = weighttype_multiplier_csvvalue.split(',');\n        var totalValue = 0.0;\n        var breakdown = '';\n        $.each(weighttype_multiplier_csvarray, function(i, value) {\n            totalValue += parseFloat(value);\n            if (i < weighttype_multiplier_csvarray.length-1) {\n                breakdown += value + '+';\n            } else {\n                breakdown += value;\n            }\n        });\n        if (!isNaN(totalValue)) {\n            var result = (totalValue - Math.floor(totalValue)) !== 0;\n            if (result) {\n                totalValue = totalValue.toFixed(2) + \"%\" + \" (\"  + breakdown.replace(/\\s/g, \"\") + \")\";\n            } else {\n                totalValue = totalValue + \"%\" + \" (\"  + breakdown.replace(/\\s/g, \"\") + \")\";\n            }\n        } else {\n            totalValue= \"N/A\";\n        }\n\n        return totalValue;\n    }\n\n    /**\n     * Calculate MultiplierPreviewValue from weightValue and multiplier on change function\n     */\n    function CalculateMultiplierPreviewValue() {\n        var weighttype_multiplier_weightvalue = $('#id_weighttype_multiplier_weightvalue').get(0).value;\n        var weighttype_multiplier_multipliervalue = $('#id_weighttype_multiplier_multipliervalue').get(0).value;\n        if (weighttype_multiplier_weightvalue && weighttype_multiplier_multipliervalue) {\n            var totalValue = weighttype_multiplier_weightvalue * weighttype_multiplier_multipliervalue;\n            if (!isNaN(totalValue)) {\n                var result = (totalValue - Math.floor(totalValue)) !== 0;\n                if (result) {\n                    totalValue = totalValue.toFixed(2);\n                }\n                var breakdown = weighttype_multiplier_multipliervalue + \" x \" +  weighttype_multiplier_weightvalue + \"%\";\n                totalValue += \"%\" + \" (\" + breakdown + \")\";\n            } else {\n                totalValue= \"N/A\";\n            }\n        } else {\n            totalValue= \"N/A\";\n        }\n        return totalValue;\n    }\n\n    /**\n     * Set the preview field based on totalvalue variable\n     * @param {*} totalValue totalvalue that will show in preview field\n     */\n    function SetPreviewValue(totalValue){\n        var static_group = $(\"[data-groupname=staticgroup] [data-fieldtype=group]\").get(0);\n        static_group.innerHTML =  totalValue;\n    }\n};\n"],"names":["SetCustomSectionName","sectionName","get","first_termvalue","selectedOptions","text","first_numbervalue","second_termvalue","second_numbervalue","sectionname_typevalue","val","value","CalculateCSVPreviewValue","weighttype_multiplier_csvarray","split","totalValue","breakdown","each","i","parseFloat","length","isNaN","result","Math","floor","toFixed","replace","CalculateMultiplierPreviewValue","weighttype_multiplier_weightvalue","weighttype_multiplier_multipliervalue","SetPreviewValue","innerHTML","on","event","defaultcustomcheckbox","target","id","checked","document","ready","weighttype_singlemultiple","removeAttr","this","disabled","undefined","attributes"],"mappings":";;;;;;8LAyBuC,cAK1BA,2BAEDC,aAAc,mBAAE,0BAA0BC,IAAI,GAC9CC,iBAAkB,mBAAE,8BAA8BD,IAAI,GAAGE,gBAAgB,GAAGC,KAC5EC,mBAAoB,mBAAE,gCAAgCJ,IAAI,GAAGE,gBAAgB,GAAGC,KAChFE,kBAAmB,mBAAE,+BAA+BL,IAAI,GAAGE,gBAAgB,GAAGC,KAC9EG,oBAAqB,mBAAE,iCAAiCN,IAAI,GAAGE,gBAAgB,GAAGC,KAElFI,uBAAwB,mBAAE,wBAAwBC,MACzB,wBAAzBD,wBAC6B,uCAAzBA,sBACAR,YAAYU,MAAQR,gBAAkB,IAAMG,kBAAoB,MAAQC,iBAAmB,IAAMC,mBACjE,uCAAzBC,sBACPR,YAAYU,MAAQR,gBAAkB,IAAMG,kBAAoB,IAAME,mBACtC,uCAAzBC,wBACPR,YAAYU,MAAQR,gBAAkB,IAAMG,6BAsE9CM,+BAEFC,gCADiC,mBAAE,sCAAsCX,IAAI,GAAGS,MAChBG,MAAM,KACtEC,WAAa,EACbC,UAAY,sBACdC,KAAKJ,gCAAgC,SAASK,EAAGP,OAC/CI,YAAcI,WAAWR,OACrBO,EAAIL,+BAA+BO,OAAO,EAC1CJ,WAAaL,MAAQ,IAErBK,WAAaL,SAGhBU,MAAMN,YAQPA,WAAY,UARQ,KAChBO,OAAUP,WAAaQ,KAAKC,MAAMT,aAAiB,EAEnDA,WADAO,OACaP,WAAWU,QAAQ,GAAnBV,MAAsCC,UAAUU,QAAQ,MAAO,IAAM,IAErEX,WAAAA,MAA2BC,UAAUU,QAAQ,MAAO,IAAM,WAMxEX,oBAMFY,sCACDC,mCAAoC,mBAAE,yCAAyC1B,IAAI,GAAGS,MACtFkB,uCAAwC,mBAAE,6CAA6C3B,IAAI,GAAGS,SAC9FiB,mCAAqCC,sCAAuC,KACxEd,WAAaa,kCAAoCC,yCAChDR,MAAMN,YAQPA,WAAY,WAPEA,WAAaQ,KAAKC,MAAMT,aAAiB,IAEnDA,WAAaA,WAAWU,QAAQ,IAGpCV,YAAc,OADEc,sCAAwC,MAASD,kCAAoC,KAC9D,SAK3Cb,WAAY,aAETA,oBAOFe,gBAAgBf,aACF,mBAAE,uDAAuDb,IAAI,GACnE6B,UAAahB,+BA1H5B,QAAQiB,GAAG,UAAU,SAASC,WACxBC,uBAAwB,mBAAE,gDAAgDhC,IAAI,GACtD,OAAxBgC,uBAA+C,OAAfD,MAAME,QAAiBF,MAAME,OAAOC,IAAMF,sBAAsBE,IACpE,GAAxBH,MAAME,OAAOE,SACbrC,8CAKVsC,UAAUC,OAAM,eACVC,2BAA4B,mBAAE,iCAAiC9B,SAClC,iCAA7B8B,0BAEAV,gBADiBlB,iCAEd,GAAiC,wCAA7B4B,0BAAqE,CAE5EV,gBADiBH,2DAKvB,QAAQK,GAAG,UAAU,+BACjB,0BAA0BS,WAAW,aAEzB,mBAAE,eAGRxB,MAAK,WACY,GAAjByB,KAAKC,eAC2BC,IAA5BF,KAAKG,WAAL,OAAoE,OAA3BH,KAAKG,WAAL,aACpCF,UAAW,OACXhC,MAAQ+B,KAAKG,WAAL,MAAyBlC,WACjCgC,UAAW,6BAM9B,4BAA4BX,GAAG,UAAU,WACvChC,8CAGF,iCAAiCgC,GAAG,UAAU,eACxCQ,2BAA4B,mBAAE,iCAAiC9B,SAClC,iCAA7B8B,0BAEAV,gBADiBlB,iCAEd,GAAiC,wCAA7B4B,0BAAqE,CAE5EV,gBADiBH,2DAKvB,sCAAsCK,GAAG,UAAU,WAEjDF,gBADiBlB,mDAInB,gCAAgCoB,GAAG,UAAU,WAE3CF,gBADiBH"}